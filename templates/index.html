{% extends "base.html" %}

{% block content %}
<div class="row mb-5">
    <div class="col-md-12">
        <div class="card" style="background: linear-gradient(135deg, #2D5016 0%, #228B22 100%); color: white; border-radius: 20px;">
            <div class="card-body text-center py-5">
                <h1 class="display-4 mb-3">
                    <i class="bi bi-mountains"></i>
                    {% if lang == 'hi' %}
                        पहाड़ों से, आपके घर तक
                    {% else %}
                        From the Mountains, To Your Home
                    {% endif %}
                </h1>
                <p class="lead mb-4">
                    {% if lang == 'hi' %}
                        शुद्ध, ताजा और प्राकृतिक डेयरी उत्पाद<br>
                        <strong>शुद्ध दूध, शुद्ध पहाड़</strong>
                    {% else %}
                        Pure, Fresh and Natural Dairy Products<br>
                        <strong>Pure Milk, Pure Pahad</strong>
                    {% endif %}
                </p>
                <div class="d-inline-block bg-white text-dark px-4 py-2 rounded-pill">
                    <i class="bi bi-heart-fill text-danger"></i> 
                    <strong>हिमगांव डेयरी / HimGaon Dairy</strong>
                </div>
            </div>
        </div>
    </div>
</div>

<h2 class="mb-4 text-center" style="color: var(--mountain-green); font-weight: 700;">
    {% if lang == 'hi' %}
        <i class="bi bi-basket"></i> हमारे उत्पाद
    {% else %}
        <i class="bi bi-basket"></i> Our Products
    {% endif %}
</h2>

{% if products %}
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    {% for product in products %}
    <div class="col">
        <div class="card h-100">
            <img src="{{ product.image_url }}" class="card-img-top" alt="{{ product.name_en }}" 
                 style="height: 250px; object-fit: cover; border-radius: 15px 15px 0 0;">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title" style="color: var(--mountain-green);">
                    {% if lang == 'hi' %}{{ product.name_hi }}{% else %}{{ product.name_en }}{% endif %}
                </h5>
                <p class="card-text text-muted small flex-grow-1">
                    {% if lang == 'hi' %}{{ product.description_hi }}{% else %}{{ product.description_en }}{% endif %}
                </p>
                <div class="mt-auto">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <p class="price-tag mb-0">
                            <span class="rupee">₹</span>{{ "%.0f"|format(product.price) }}
                        </p>
                        {% if product.stock > 0 %}
                            <p class="text-success mb-0">
                                <small><i class="bi bi-check-circle-fill"></i>
                                {% if lang == 'hi' %}स्टॉक: {{ product.stock }}{% else %}Stock: {{ product.stock }}{% endif %}
                                </small>
                            </p>
                        {% else %}
                            <p class="text-danger mb-0">
                                <small>{% if lang == 'hi' %}स्टॉक में नहीं{% else %}Out of Stock{% endif %}</small>
                            </p>
                        {% endif %}
                    </div>

                    {% if product.stock > 0 %}
                        <form class="add-to-cart-form" data-product-id="{{ product.id }}">
                            <div class="input-group">
                                <input type="number" name="quantity" class="form-control" value="1" min="1" max="{{ product.stock }}">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-cart-plus"></i>
                                    {% if lang == 'hi' %}जोड़ें{% else %}Add{% endif %}
                                </button>
                            </div>
                        </form>
                    {% else %}
                        <button class="btn btn-secondary w-100" disabled>
                            {% if lang == 'hi' %}उपलब्ध नहीं{% else %}Unavailable{% endif %}
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="alert alert-info text-center">
    {% if lang == 'hi' %}फिलहाल कोई उत्पाद उपलब्ध नहीं है।{% else %}No products available.{% endif %}
</div>
{% endif %}

<div class="text-center mt-5 mb-3">
    <i class="bi bi-mountains" style="font-size: 3rem; color: var(--mountain-green); opacity: 0.3;"></i>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.querySelectorAll('.add-to-cart-form').forEach(form => {
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        const productId = this.dataset.productId;
        const quantity = this.querySelector('input[name="quantity"]').value;

        fetch(`/add-to-cart/${productId}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: `quantity=${quantity}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('cart-count').textContent = data.cart_count;
                alert(data.message);
            } else {
                alert(data.message);
            }
        })
        .catch(error => alert('Error adding to cart'));
    });
});
</script>
{% endblock %}
